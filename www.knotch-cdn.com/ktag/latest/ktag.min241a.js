!function(){"use strict";function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function e(e,t){var n,r=Object.keys(e);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(e),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)),r}function n(r){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?e(Object(o),!0).forEach(function(t){var e,n;e=r,t=o[n=t],n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):e(Object(o)).forEach(function(t){Object.defineProperty(r,t,Object.getOwnPropertyDescriptor(o,t))})}return r}function r(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],r=!0,o=!1,a=void 0;try{for(var i,c=t[Symbol.iterator]();!(r=(i=c.next()).done)&&(n.push(i.value),!e||n.length!==e);r=!0);}catch(t){o=!0,a=t}finally{try{r||null==c.return||c.return()}finally{if(o)throw a}}return n}(t,e)||a(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(t){return function(t){if(Array.isArray(t))return c(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||a(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(t,e){if(t){if("string"==typeof t)return c(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c(t,e):void 0}}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function s(t,e){var n,r,o,a=[];for(n in t)t.hasOwnProperty(n)&&(r=e?"".concat(e,"[").concat(n,"]"):n,o=t[n],a.push(null!==o&&"object"===i(o)?s(o,r):"".concat(encodeURIComponent(r),"=").concat(encodeURIComponent(o))));return a.join("&")}var u={set:function(t,e,n,r){var o;return t?(r=r||{},n&&(o=(new Date).getTime()+1e3*n),window.document.cookie=[encodeURIComponent(t),"=",encodeURIComponent(String(e)),o?"; expires="+new Date(o).toUTCString():"","; path="+(r.path||"/"),r.domain?"; domain="+r.domain:"",window.location&&"https:"===window.location.protocol?"; secure":""].join("")):null},get:function(t,e){return(e=new RegExp("(?:^|; )"+encodeURIComponent(t)+"=([^;]*)").exec(window.document.cookie))?decodeURIComponent(e[1]):null},delete:function(t,e){u.set(t,null,-1,e)}};function d(){var t=["%cKTag","color: white; background: #24c9a0; padding: 4px"].concat(o(Array.prototype.slice.call(arguments)));console.log.apply(console,t)}function l(t,e){var n=1<arguments.length&&void 0!==e?e:"ktag";try{var r,o=document.currentScript,a=document.querySelector('script[src*="'.concat(n,'.js"]')),i=document.querySelector('script[src*="'.concat(n,'.min.js"]'));if(a)r=a;else if(i)r=i;else{if(!o)return Knotch.debug.reportError(new Error("script not found"));r=o}return r.getAttribute(t)}catch(t){return!1}}function p(t){return/^((([A-Za-z]{3,9}:(?:\/\/)?)(?:[\-;:&=\+\$,\w]+@)?[A-Za-z0-9\.\-]+|(?:www\.|[\-;:&=\+\$,\w]+@)[A-Za-z0-9\.\-]+)((?:\/[\+~%\/\.\w\-_]*)?\??(?:[\-\+=&;%@\.\w_]*)#?(?:[\.\!\/\\\w]*))?)/.test(t)}function g(t){var e=t.accountId,e={browser_url:(t=null,document.URL?t=document.URL:window.location.href?t=window.location.href:window.location.host&&window.location.pathname&&(t="".concat(window.location.protocol,"//").concat(window.location.host).concat(window.location.pathname)),t),root_browser_url:(t=null,window.location.host&&window.location.pathname&&(t="".concat(window.location.protocol,"//").concat(window.location.host).concat(window.location.pathname)),t),canonical_url:function(){var t=document.querySelector("meta[property='og:url']");if(t&&0<t.getAttribute("content").length){var e=t.getAttribute("content");if(p(e))return e}e=document.querySelector("link[rel=canonical]");if(e&&0<e.getAttribute("href").length){var n=e.getAttribute("href");if(p(n))return n}n=document.querySelector("meta[name='canonical']");if(n&&0<n.getAttribute("content").length){n=n.getAttribute("content");if(p(n))return n}return null}(),referrer_url:document.referrer,account_id:e,cs_render_id:window.ktag.renderId,cs_visitor_id:window.ktag.visitorId,time_stamp:Date.now(),session_time_stamp:window.ktag.loadTime,user_agent:window.ktag.userAgent,ktag_version:window.ktag.config.version};return document.body&&function(t){t=t||{};for(var e=1;e<arguments.length;e++)if(arguments[e])for(var n in arguments[e])arguments[e].hasOwnProperty(n)&&(t[n]=arguments[e][n])}(e,{content_height:document.body.scrollHeight,content_width:document.body.scrollWidth}),e}function f(t){if(!t||!Object.keys(t).length)return console.warn("empty custom payload");if(1024<JSON.stringify(t).length)return console.warn("custom payload too large");for(var e in t){if(-1===h.indexOf(i(t[e])))return console.warn("Invalid payload type for: ".concat(e,". Only strings & numbers allowed"));if(-1!==m.indexOf(e))return console.warn("Forbidden key used: ".concat(e))}return t}function t(){if(URL.createObjectURL){var t=URL.createObjectURL(new Blob);return t.substring(t.lastIndexOf("/")+1)}return crypto.getRandomValues?"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e;return"y"===t?(e=["8","9","a","b"])[Math.floor(Math.random()*e.length)]:(e=new Uint8Array(1),crypto.getRandomValues(e),(e[0]%16).toString(16))}):null}var w={set:function(t,e,n,r){var o;return t?(r=r||{},n&&(o=(new Date).getTime()+1e3*n),window.document.cookie=[encodeURIComponent(t),"=",encodeURIComponent(String(e)),o?"; expires="+new Date(o).toUTCString():"","; path="+(r.path||"/"),r.domain?"; domain="+r.domain:"",window.location&&"https:"===window.location.protocol?"; secure":""].join("")):null},get:function(t,e){return(e=new RegExp("(?:^|; )"+encodeURIComponent(t)+"=([^;]*)").exec(window.document.cookie))?decodeURIComponent(e[1]):null},delete:function(t,e){w.set(t,null,-1,e)}},m=["browser_url","canonical_url","referrer_url","account_id","time_stamp","session_time_stamp","user_agent","ktag_version","content_height","content_width"],h=["string","number"];function y(t){this.config=t||{},this.url="https://notify.bugsnag.com/js?",this.user={},this.device={},this.startTime=(new Date).getTime(),this.breadcrumbs=[{name:"Bugsnag Loaded",timestamp:this.startTime,type:"navigation"}]}y.prototype={setUser:function(t){this.user=t},setDevice:function(t){this.device=t},pushBreadCrumb:function(t){t.timestamp=(new Date).getTime(),t.type||(t.type="process"),this.breadcrumbs.push(t),30<this.breadcrumbs.length&&this.breadcrumbs.shift(),window.ktag&&window.ktag.debug&&d(t)},reportError:function(t,e){var n=window.ktag&&window.ktag.debug,r=this.config,o=r.env,r=r.version;"development"===o||"test"===o||n||"development"===r?console.error(t):(e=s(this.payloadData(t,e)),(new Image).src=this.url+e)},payloadData:function(t,e){if(t)return e=e||{},{apiKey:"9cfd033580df1ff429d3aa324d26dded",breadcrumbs:this.breadcrumbs,context:window.location.href,ct:"img",cb:(new Date).getTime(),language:"en-US",message:t.message,metaData:e.data,name:e.name||t.message,notifierVersion:"3.0.7",payloadVersion:"3",releaseStage:this.config.env,severity:e.severity||"error",stacktrace:t.stack,url:window.location.href,user:this.user||e.user,userAgent:navigator.userAgent,appVersion:this.config.version||"dev"}}},self!==top&&(window.bugsnag=new y(window.knotchConfig));function v(){return window.ktag.trackers&&window.ktag.trackers.content&&window.ktag.trackers.content.NodeMapper}var b,k,x,j,E,O={setDataLayer:function(t){"object"===i(t)&&f(t)&&window.ktag.dataLayer.push(t)}},_={getContent:function(){if(!v())throw new Error("No NodeMapper present");var t=window.ktag.trackers.content.NodeMapper.pageBodyNode;if(t)return t.ref().innerText},getTitle:function(){if(!v())throw new Error("No NodeMapper present");var t=window.ktag.trackers.content.NodeMapper.pageMeta,t=(void 0===t?{}:t).metaTags;if(t["og:title"])return t["og:title"];t=document.querySelector("h1");return t?t.innerText:""},getMetaTags:function(){if(!v())throw new Error("No NodeMapper present");var t=window.ktag.trackers.content.NodeMapper.pageMeta,t=(void 0===t?{}:t).metaTags;return 0<Object.keys(t).length?t:{}},getDate:function(){if(!v())throw new Error("No NodeMapper present");var t=window.ktag.trackers.content.NodeMapper.pageMeta,t=(void 0===t?{}:t).metaTags;return t["article:published_time"]?new Date(t["article:published_time"]).toUTCString():{}},getImages:function(){if(!v())throw new Error("No NodeMapper present");var t=window.ktag.trackers.content.NodeMapper.contentElements;return t&&t.images?t.images.map(function(t){return t.ref()}):[]},getVideos:function(){if(!v())throw new Error("No NodeMapper present");var t=window.ktag.trackers.content.NodeMapper.contentElements;return t&&t.videos?t.videos.map(function(t){return t.ref()}):[]}},_=n(n(n({},{sendCustomEvent:function(t){"object"===i(t)&&f(t)&&window.ktag.trackEvent(t)}}),O),_),S={page:"pagetracker.min.js",content:"contenttracker.min.js",feedback_card:"FeedbackCard.min.js"};window.ktag||(window.ktag=n(n({},_),{},{dataLayer:window.dataLayer||[],trackers:[],loadTime:Date.now(),accountId:function(){var t=l("src");if(!t||!t.length)return null;t=r(t.split("?"),2),t[0],t=t[1];if(!t||!t.split("=").length)return null;t=r(t.split("="),2),t[0],t=t[1];return t||null}(),renderId:t(),visitorId:(j="kn_cs_visitor_id",(E=w.get(j))||(x=t(),w.set(j,x,31536e3),E=w.get(j)),E),userAgent:"".concat(navigator.userAgent),config:{env:"production",ingress:"https://aq-swa-api.knotch.it/ingress.gif",accountConfig:"https://units.knotch.it/ktag-config",version:"v0.3.0",measurementCard:"measurementCard.min.js",theme:"https://units.knotch.it/themes",deliveryEngine:"https://delivery.knotch.it/"},bugsnag:new y(window.config),isDemo:(b=function(t){try{var e=document.querySelector('script[src*="ktag"]')||document.currentScript,n=""===e.getAttribute(t),e="true"===e.getAttribute(t)||"1"===e.getAttribute(t);return n||e}catch(t){return!1}}("demo"),k="true"===u.get("knotch_demo"),!(!b&&!k)),init:function(){if(!this.accountId)return this.bugsnag.reportError("no account id provided in the script source");var t,e,n;this.trackEvent({type:"page_view"},{setCookie:!0}),this.getAccountConfig(),t="message",e=window,n=this.handleIFrameEvents.bind(this),e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent(t,n)},trackEvent:function(t,e){t&&!this.isDemo&&function(t,e,n){var r=2<arguments.length&&void 0!==n?n:{},n=new Image(1,1);!0===r.setCookie&&(t.set_cookie="true"),r=t.url||"".concat(e.ingress,"?").concat(s(t)),n.src=r,"production"!==e.env&&d("event sent: ".concat(t.type),t)}(n(n(n({},this.processDataLayer()),g({accountId:this.accountId,config:this.config})),t),this.config,e)},handleIFrameEvents:function(t){var e=t.data,t=e.data;"knotchEvent"===e.eventType&&this.trackEvent(t)},processDataLayer:function(){return Array.isArray(this.dataLayer)?this.dataLayer.reduce(function(t,e){return f(e)?n(n({},t),e):t},{}):(console.warn("Invalid dataLayer"),{})},getAccountConfig:function(){var n,r,o,a,i,c=this;n="".concat(this.config.accountConfig,"/").concat(this.accountId,".json"),r=function(t){c.accountConfig=t,c.injectModules(t)},o=function(t,e,n,r,o){return c.bugsnag.reportError(e,{data:{readyState:n,responseText:r,responseHeaders:o,status:t},severity:"info"})},a=void 0!==XMLHttpRequest.DONE?XMLHttpRequest.DONE:4,(i=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")).onerror=function(){return 500<=i.status&&window.ktag.bugsnag.reportError(new Error(i.responseText),{name:"".concat(i.status," request error"),data:data}),!1},i.onreadystatechange=function(){if(i.readyState===a)if(200===i.status){var e=i.responseText;if(e)try{var t=JSON.parse(e)}catch(t){window.ktag.bugsnag.reportError(t,{name:"failed to parse request response",data:{responseText:e,url:n}})}r(t)}else 500<=i.status&&o(i.status,i.statusText,i.readyState,i.responseText,i.getAllResponseHeaders())},i.open("GET",n,!0),i.setRequestHeader("Content-Type","application/json;charset=UTF-8"),i.send()},injectModules:function(t){t&&t.modules&&t.modules.map(function(t){var e,n,e=((n=l("src"))&&-1<n.indexOf("ktag.js")?e=n.indexOf("ktag.js"):-1<n.indexOf("ktag.min.js")?e=n.indexOf("ktag.min.js"):window.ktag.bugsnag.reportError(new Error("knotch script not on page")),n.slice(0,e)+S[t]);S[t]&&function(t){var e=document.createElement("script");e.async=1,e.src=t;t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}(e)})}}),window.ktag.init())}();
